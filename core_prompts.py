"""
Core Banking Notification Prompts
=================================

This file contains only the essential prompt definitions and helper functions
for generating banking push notifications. No Azure OpenAI integration.
"""

# =============================================================================
# HELPER FUNCTIONS FOR DYNAMIC INSTRUCTIONS
# =============================================================================

def get_age_instructions(age):
    """Get age-specific TOV instructions"""
    if age <= 25:
        return "- Для молодёжи: меньше официоза, чуть живее; без жаргона «в лоб»; можно лёгкий юмор и 1 эмодзи по смыслу"
    else:
        return "- Для взрослых: на равных, просто и по-человечески, доброжелательно; без драматизации и морали"

def get_status_instructions(status):
    """Get status-specific TOV instructions"""
    if status == "Студент":
        return "- Для студентов: на равных, просто и по-человечески; можно лёгкий юмор и разговорные выражения"
    elif status == "Премиальный клиент":
        return "- Для премиальных клиентов: на равных, уважительно, без официоза; подчеркнуть статус"
    else:
        return "- Стандартный тон: на равных, просто и по-человечески, доброжелательно"

# Currency symbols mapping
currency_symbols = {
    'KZT': '₸',
    'USD': '$',
    'EUR': '€',
    'RUB': '₽'
}

def get_currency_symbol(currency):
    return currency_symbols.get(currency, currency)

def get_cta_variants(product_type):
    """Get varied CTA options for different products"""
    cta_variants = {
        "Карта для путешествий": [
            "Оформить карту", "Откройте карту", "Подключить карту", 
            "Хотите оформить?", "Оформить сейчас", "Заказать карту"
        ],
        "Премиальная карта": [
            "Оформить сейчас", "Подключить карту", "Открыть карту",
            "Оформить карту", "Активировать карту", "Заказать карту"
        ],
        "Кредитная карта": [
            "Оформить карту", "Открыть карту", "Подключить карту",
            "Заказать карту", "Оформить сейчас", "Активировать карту"
        ],
        "Обмен валют": [
            "Настроить обмен", "Открыть обмен", "Подключить обмен",
            "Активировать обмен", "Настроить сейчас", "Включить обмен"
        ],
        "Кредит наличными": [
            "Узнать лимит", "Оформить кредит", "Проверить условия",
            "Узнать условия", "Рассчитать кредит", "Подать заявку"
        ],
        "Депозит мультивалютный": [
            "Открыть вклад", "Оформить депозит", "Подключить вклад",
            "Создать вклад", "Открыть сейчас", "Оформить сейчас"
        ],
        "Депозит сберегательный": [
            "Открыть вклад", "Оформить депозит", "Подключить вклад",
            "Создать вклад", "Открыть сейчас", "Оформить сейчас"
        ],
        "Депозит накопительный": [
            "Открыть вклад", "Оформить депозит", "Подключить вклад",
            "Создать вклад", "Открыть сейчас", "Оформить сейчас"
        ],
        "Инвестиции": [
            "Открыть счёт", "Начать инвестировать", "Подключить инвестиции",
            "Создать счёт", "Открыть сейчас", "Начать сейчас"
        ],
        "Золотые слитки": [
            "Купить золото", "Открыть счёт", "Подключить золото",
            "Приобрести золото", "Купить сейчас", "Заказать золото"
        ]
    }
    return cta_variants.get(product_type, ["Оформить сейчас", "Подключить", "Открыть"])

# =============================================================================
# PROMPT 1: КАРТА ДЛЯ ПУТЕШЕСТВИЙ (TRAVEL CARD)
# =============================================================================

TRAVEL_CARD_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для карты путешествий.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}
- currencies: {currencies} (валюты, которые использует клиент)

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- taxi_rides_count: {taxi_rides_count} (количество поездок на такси за месяц)
- taxi_spent_amount: {taxi_spent_amount} (потрачено на такси за месяц в KZT)
- travel_spent_amount: {travel_spent_amount} (потрачено на путешествия за месяц в KZT)
- hotels_spent_amount: {hotels_spent_amount} (потрачено на отели за месяц в KZT)
- month: {month} (месяц для персонализации)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 80-120 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- Используй валюту клиента: KZT=₸, USD=$, EUR=€
- CTA: используй разные варианты из списка: {cta_variants}

СТРУКТУРА:
1. Персональный контекст (наблюдение по тратам/поведению)
2. Польза/объяснение (как продукт решает задачу)
3. Чёткий CTA (выбери один из вариантов)

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Рамазан, заметили, что в августе вы очень активно пользовались такси — 12 поездок на 27 400 ₸. С картой для путешествий вернули бы около 1 100 ₸ кешбэка. Хотите оформить?"
- "Алия, видим, что в сентябре у вас много поездок и трат на отели. С тревел-картой часть этих расходов вернулась бы кешбэком. Подключить карту? ✈️"
- "Данияр, вы часто путешествуете и пользуетесь такси — это видно по вашим тратам. С картой для путешествий получили бы кешбэк с каждой поездки. Откройте карту."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Карта для путешествий", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 2: ПРЕМИАЛЬНАЯ КАРТА (PREMIUM CARD)
# =============================================================================

PREMIUM_CARD_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для премиальной карты.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}
- currencies: {currencies} (валюты, которые использует клиент)

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- restaurants_spent: {restaurants_spent} (потрачено в ресторанах за месяц в KZT)
- cosmetics_spent: {cosmetics_spent} (потрачено на косметику за месяц в KZT)
- jewelry_spent: {jewelry_spent} (потрачено на ювелирку за месяц в KZT)
- atm_withdrawals_count: {atm_withdrawals_count} (количество снятий в банкомате)
- transfers_count: {transfers_count} (количество переводов)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- Используй валюту клиента: KZT=₸, USD=$, EUR=€
- CTA: используй разные варианты из списка: {cta_variants}

СТРУКТУРА:
1. Персональный контекст (наблюдение по остатку и тратам)
2. Польза/объяснение (кешбэк и привилегии)
3. Чёткий CTA (выбери один из вариантов)

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Подчеркивай статус и заслуженность клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас стабильно высокий остаток и активные траты в ресторанах. Премиальная карта даст до 4% кешбэка на все покупки и бесплатные снятия. Подключить сейчас."
- "Елена, видим, что вы любите качественную косметику и рестораны. С премиальной картой получили бы повышенный кешбэк и эксклюзивные привилегии. Оформить карту? 💎"
- "Руслан, с вашим высоким балансом и тратами на ювелирку вы заслуживаете большего. Премиальная карта предлагает до 5% кешбэка и особые привилегии. Активировать карту."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Премиальная карта", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 3: КРЕДИТНАЯ КАРТА (CREDIT CARD)
# =============================================================================

CREDIT_CARD_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для кредитной карты.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}
- currencies: {currencies} (валюты, которые использует клиент)

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- top_category_1: {top_category_1} (первая топ-категория трат)
- top_category_2: {top_category_2} (вторая топ-категория трат)
- top_category_3: {top_category_3} (третья топ-категория трат)
- online_services_spent: {online_services_spent} (потрачено на онлайн-сервисы в KZT)
- installment_payments: {installment_payments} (есть ли платежи по рассрочке)
- cc_repayments: {cc_repayments} (есть ли погашения кредитной карты)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- Используй валюту клиента: KZT=₸, USD=$, EUR=€
- CTA: используй разные варианты из списка: {cta_variants}

СТРУКТУРА:
1. Персональный контекст (топ-категории трат)
2. Польза/объяснение (кешбэк в любимых категориях)
3. Чёткий CTA (выбери один из вариантов)

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание предпочтений клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что вы часто тратите на кафе, одежду и развлечения. Кредитная карта даст до 10% кешбэка именно в ваших любимых категориях. Открыть карту."
- "Данияр, видим, что вы много тратите на продукты, такси и кино. С кредитной картой получили бы до 10% кешбэка в этих категориях. Подключить карту? 💳"
- "Сабина, ваши основные траты — одежда, косметика и развлечения. Кредитная карта даст повышенный кешбэк именно в том, что вам нравится. Заказать карту."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Кредитная карта", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 4: ОБМЕН ВАЛЮТ (CURRENCY EXCHANGE)
# =============================================================================

CURRENCY_EXCHANGE_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для обмена валют.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}
- currencies: {currencies} (валюты, которые использует клиент)

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- fx_buy_count: {fx_buy_count} (количество покупок валюты)
- fx_sell_count: {fx_sell_count} (количество продаж валюты)
- main_foreign_currency: {main_foreign_currency} (основная иностранная валюта)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 80-120 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- Используй валюту клиента: KZT=₸, USD=$, EUR=€
- CTA: используй разные варианты из списка: {cta_variants}

СТРУКТУРА:
1. Персональный контекст (активность с валютой)
2. Польза/объяснение (выгодный обмен)
3. Чёткий CTA (выбери один из вариантов)

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание валютных потребностей клиента

ВАЖНО: 
- Если main_foreign_currency = "иностранной валюте" → используй "вы часто работаете с валютой" или "у вас активность с валютными операциями"
- Если main_foreign_currency = "USD" → используй "вы часто платите в USD"
- Если main_foreign_currency = "EUR" → используй "вы часто платите в EUR"
- НЕ упоминай USD или EUR или другие валюты, если они не указаны в main_foreign_currency
- Используй только те валюты, которые есть в currencies клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что вы часто работаете с валютой. В приложении выгодный обмен и авто-покупка по целевому курсу. Настроить обмен."
- "Данияр, видим, что у вас активность с валютными операциями. В приложении выгодный обмен валют и авто-покупка по целевому курсу. Активировать обмен? 💱"
- "Руслан, у вас активность с валютными операциями. В приложении выгодный обмен и авто-покупка по целевому курсу. Подключить обмен."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Обмен валют", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 5: КРЕДИТ НАЛИЧНЫМИ (CASH LOAN)
# =============================================================================

CASH_LOAN_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для кредита наличными.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- monthly_inflow: {monthly_inflow} (месячные поступления в KZT)
- monthly_outflow: {monthly_outflow} (месячные расходы в KZT)
- loan_payments_count: {loan_payments_count} (количество платежей по кредитам)
- low_balance_days: {low_balance_days} (дни с низким остатком)
- cash_need_indicators: {cash_need_indicators} (индикаторы потребности в наличных)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Узнать лимит", "Оформить кредит", "Проверить условия"

СТРУКТУРА:
1. Персональный контекст (потребность в финансировании)
2. Польза/объяснение (быстрый доступ к деньгам)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание финансовых потребностей клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас могут быть крупные траты. Если нужен запас — можно оформить кредит наличными с гибкими выплатами. Узнать лимит."
- "Данияр, если планируете крупные покупки — кредит наличными даст быстрый доступ к финансированию. Узнать доступный лимит? 💰"
- "Тимур, если нужны дополнительные средства — можно оформить кредит наличными с удобными условиями погашения. Узнать лимит."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Кредит наличными", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 6: ДЕПОЗИТ МУЛЬТИВАЛЮТНЫЙ (MULTI-CURRENCY DEPOSIT)
# =============================================================================

MULTI_CURRENCY_DEPOSIT_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для мультивалютного депозита.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- free_balance: {free_balance} (свободный остаток в KZT)
- fx_activity_score: {fx_activity_score} (активность с валютой 1-10)
- foreign_spending: {foreign_spending} (траты за рубежом в KZT)
- deposit_fx_topup_count: {deposit_fx_topup_count} (пополнения валютного депозита)
- deposit_fx_withdraw_count: {deposit_fx_withdraw_count} (снятия с валютного депозита)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Открыть вклад", "Оформить депозит", "Подключить вклад"

СТРУКТУРА:
1. Персональный контекст (свободные средства и валютная активность)
2. Польза/объяснение (проценты и удобство)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание валютных потребностей клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас остаются свободные средства. Мультивалютный депозит даст проценты и удобство хранения. Открыть вклад."
- "Данияр, видим, что вы активно работаете с валютой. Мультивалютный депозит даст проценты и удобство хранения в разных валютах. Открыть вклад? 🌍"
- "Елена, у вас высокий остаток и зарубежные траты. Мультивалютный депозит поможет копить в разных валютах. Открыть вклад."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Депозит мультивалютный", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 7: ДЕПОЗИТ СБЕРЕГАТЕЛЬНЫЙ (SAVINGS DEPOSIT)
# =============================================================================

SAVINGS_DEPOSIT_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для сберегательного депозита.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- stable_balance: {stable_balance} (стабильный остаток в KZT)
- spending_volatility: {spending_volatility} (волатильность расходов 1-10)
- deposit_topup_count: {deposit_topup_count} (пополнения депозита)
- deposit_withdraw_count: {deposit_withdraw_count} (снятия с депозита)
- balance_stability_score: {balance_stability_score} (стабильность остатка 1-10)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Открыть вклад", "Оформить депозит", "Подключить вклад"

СТРУКТУРА:
1. Персональный контекст (свободные средства и валютная активность)
2. Польза/объяснение (проценты и удобство)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание финансовых целей клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас остаются свободные средства. Сберегательный депозит даст максимальную ставку за счёт отсутствия снятий. Открыть вклад."
- "Руслан, видим, что у вас стабильный крупный остаток. Сберегательный депозит даст максимальную ставку за счёт отсутствия снятий. Открыть вклад? 🏦"
- "Мадина, у вас стабильные финансы. Сберегательный депозит поможет получить максимальный доход. Открыть вклад."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Депозит сберегательный", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 8: ДЕПОЗИТ НАКОПИТЕЛЬНЫЙ (ACCUMULATIVE DEPOSIT)
# =============================================================================

ACCUMULATIVE_DEPOSIT_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для накопительного депозита.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- regular_balance: {regular_balance} (регулярный остаток в KZT)
- periodic_topups: {periodic_topups} (периодические пополнения)
- topup_frequency: {topup_frequency} (частота пополнений в месяц)
- savings_behavior_score: {savings_behavior_score} (поведение накоплений 1-10)
- small_regular_amounts: {small_regular_amounts} (небольшие регулярные суммы)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Открыть вклад", "Оформить депозит", "Подключить вклад"

СТРУКТУРА:
1. Персональный контекст (свободные средства и валютная активность)
2. Польза/объяснение (проценты и удобство)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание накопительных привычек клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас остаются свободные средства. Накопительный депозит позволит копить с повышенной ставкой. Открыть вклад."
- "Сабина, видим, что вы регулярно откладываете небольшие суммы. Накопительный депозит поможет эффективно копить. Открыть вклад? 📈"
- "Тимур, вы регулярно откладываете небольшие суммы. Накопительный депозит поможет эффективно копить. Открыть вклад."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Депозит накопительный", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 9: ИНВЕСТИЦИИ (INVESTMENTS)
# =============================================================================

INVESTMENTS_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для инвестиций.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- available_funds: {available_funds} (свободные средства в KZT)
- invest_in_count: {invest_in_count} (вводы в инвестиции)
- invest_out_count: {invest_out_count} (выводы из инвестиций)
- investment_interest_score: {investment_interest_score} (интерес к инвестициям 1-10)
- risk_tolerance: {risk_tolerance} (толерантность к риску 1-10)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Открыть счёт", "Начать инвестировать", "Подключить инвестиции"

СТРУКТУРА:
1. Персональный контекст (свободные средства)
2. Польза/объяснение (низкий порог входа)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание инвестиционных потребностей клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас есть свободные средства. Инвестиции дадут возможность роста с низким порогом входа. Открыть счёт."
- "Данияр, видим, что у вас есть свободные средства. Инвестиции дадут возможность роста с низким порогом входа. Открыть счёт? 📊"
- "Елена, попробуйте инвестиции с нулевыми комиссиями на старт и низким порогом входа. Открыть счёт."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Инвестиции", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# PROMPT 10: ЗОЛОТЫЕ СЛИТКИ (GOLD BARS)
# =============================================================================

GOLD_BARS_PROMPT = """
Ты - эксперт по банковскому маркетингу. Создай персонализированное пуш-уведомление для золотых слитков.

ДАННЫЕ КЛИЕНТА:
- client_code: {client_code}
- name: {name}
- status: {status}
- age: {age}
- city: {city}
- avg_monthly_balance_KZT: {avg_monthly_balance_KZT}

ДОПОЛНИТЕЛЬНЫЕ ДАННЫЕ:
- high_liquidity: {high_liquidity} (высокая ликвидность средств)
- gold_buy_count: {gold_buy_count} (покупки золота)
- gold_sell_count: {gold_sell_count} (продажи золота)
- jewelry_spent: {jewelry_spent} (траты на ювелирку в KZT)
- value_preservation_interest: {value_preservation_interest} (интерес к сохранению стоимости 1-10)

ПРАВИЛА TOV:
{age_instructions}
{status_instructions}
- Обращение на "вы" с маленькой буквы, без драматизации и морали
- На равных, просто и по-человечески; доброжелательно
- Важное — в начало, без воды/канцеляризмов/пассивного залога
- Допустим лёгкий, ненавязчивый юмор; эмодзи — 0-1 по смыслу
- Длина 180-220 символов для пушей
- Без КАПС, максимум один восклицательный знак
- Числа: дробная часть запятая, разряды пробелы (2 490 ₸)
- CTA: "Купить золото", "Открыть счёт", "Подключить золото"

СТРУКТУРА:
1. Персональный контекст (ликвидность и интерес к ценностям)
2. Польза/объяснение (защитный актив)
3. Чёткий CTA

ВАЖНО ДЛЯ ЧЕЛОВЕЧНОСТИ:
- Используй конкретные детали из трат клиента
- Добавляй личные наблюдения ("заметили", "видим", "видно")
- Включай эмоциональные слова ("удобно", "выгодно", "приятно")
- Создавай ощущение индивидуального подхода
- Избегай шаблонных фраз, будь естественным
- Показывай понимание инвестиционных предпочтений клиента

ПРИМЕРЫ ЧЕЛОВЕЧНЫХ УВЕДОМЛЕНИЙ:
- "Алия, заметили, что у вас высокая ликвидность средств. Золотые слитки — надёжный защитный актив. Купить золото."
- "Руслан, видим, что у вас высокий остаток и интерес к драгоценностям. Золотые слитки — надёжный способ сохранения стоимости. Купить золото? 🥇"
- "Мадина, у вас стабильные финансы и интерес к ценностям. Золотые слитки — защитный актив для диверсификации. Купить золото."

Верни ТОЛЬКО JSON в формате:
{{"client_code": {client_code}, "product": "Золотые слитки", "push_notification": "текст уведомления"}}
"""

# =============================================================================
# DICTIONARY OF ALL PROMPTS
# =============================================================================

BANKING_PROMPTS = {
    "Карта для путешествий": TRAVEL_CARD_PROMPT,
    "Премиальная карта": PREMIUM_CARD_PROMPT,
    "Кредитная карта": CREDIT_CARD_PROMPT,
    "Обмен валют": CURRENCY_EXCHANGE_PROMPT,
    "Кредит наличными": CASH_LOAN_PROMPT,
    "Депозит мультивалютный": MULTI_CURRENCY_DEPOSIT_PROMPT,
    "Депозит сберегательный": SAVINGS_DEPOSIT_PROMPT,
    "Депозит накопительный": ACCUMULATIVE_DEPOSIT_PROMPT,
    "Инвестиции": INVESTMENTS_PROMPT,
    "Золотые слитки": GOLD_BARS_PROMPT
}

# =============================================================================
# CORE FUNCTIONS
# =============================================================================

def get_prompt_for_product(product_name: str) -> str:
    """
    Get the appropriate prompt for a given banking product.
    
    Args:
        product_name: Name of the banking product
        
    Returns:
        Formatted prompt string ready for OpenAI API
    """
    if product_name not in BANKING_PROMPTS:
        raise ValueError(f"Unknown product: {product_name}. Available products: {list(BANKING_PROMPTS.keys())}")
    
    return BANKING_PROMPTS[product_name]

def format_prompt_with_data(prompt: str, **kwargs) -> str:
    """
    Format a prompt with client and product-specific data.
    Automatically adds age and status specific instructions.
    
    Args:
        prompt: The prompt template
        **kwargs: Client and product data (must include 'age' and 'status')
        
    Returns:
        Formatted prompt ready for OpenAI API
    """
    # Add dynamic instructions based on age and status
    kwargs['age_instructions'] = get_age_instructions(kwargs.get('age', 30))
    kwargs['status_instructions'] = get_status_instructions(kwargs.get('status', 'Стандартный клиент'))
    
    # Add currency information
    currencies = kwargs.get('currencies', ['KZT'])
    if isinstance(currencies, list):
        kwargs['currencies'] = ', '.join(currencies)
    else:
        kwargs['currencies'] = str(currencies)
    
    # Add CTA variants for the product
    product_name = kwargs.get('product', '')
    if not product_name:
        # Try to extract from prompt content
        for product in get_available_products():
            if product in prompt:
                product_name = product
                break
    
    cta_variants = get_cta_variants(product_name)
    kwargs['cta_variants'] = ', '.join(cta_variants)
    
    return prompt.format(**kwargs)

def get_available_products():
    """Get list of all available banking products"""
    return list(BANKING_PROMPTS.keys())
